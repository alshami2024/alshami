<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุชุญุงู ุงููุงููู ุงูุฏููู ุงูุฎุงุต (ุงูุฌูุณูุฉ ูุงูููุทู)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #0056b3; --secondary-color: #007bff; --light-gray: #f8f9fa; --dark-gray: #343a40; --success-color: #28a745; --danger-color: #dc3545; --background-color: #e9ecef; --text-color: #212529; --white: #fff; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--background-color); margin: 0; padding: 20px; color: var(--text-color); direction: rtl; }
        .container { background-color: var(--white); border-radius: 15px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); width: 95%; max-width: 900px; margin: 0 auto; padding: 30px; }
        h1, h2, h3 { color: var(--dark-gray); font-weight: 700; }
        .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { background-color: var(--primary-color); color: var(--white); border: none; padding: 12px 25px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        .btn:hover { background-color: #004a99; } .btn:disabled { background-color: #ccc; }
        .btn-danger { background-color: var(--danger-color); }
        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
        .timer { font-size: 1.2em; color: var(--danger-color); font-weight: bold; }
        .question-card { background: var(--light-gray); border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: right; }
        .question-card ul { list-style: none; padding: 0; }
        .choices li { padding: 10px; margin: 8px 0; background: var(--white); border: 1px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .choices li:hover { background-color: #e3f2fd; }
        .choices li.correct { background-color: #d4edda !important; border-color: #c3e6cb; }
        .choices li.incorrect { background-color: #f8d7da !important; border-color: #f5c6cb; }
        #navigation-buttons { display: flex; justify-content: space-between; margin-top: 20px; }
        #progressBarContainer { width: 100%; background-color: #e9ecef; border-radius: 20px; margin-bottom: 25px; overflow: hidden; }
        #progressBar { width: 0%; height: 20px; background-color: var(--success-color); border-radius: 20px; transition: width 0.5s; text-align: center; color: white; line-height: 20px; }
        #certificate { display: none; border: 5px solid var(--primary-color); padding: 30px; margin-top: 30px; text-align: center; background: linear-gradient(135deg, #f9f9f9, #eef8ff); }
        #startScreen, #examArea, #resultContainer { display: none; }
    </style>
</head>
<body>
<div class="container">
    <div id="studentExamView" style="display:block;">
        <div id="startScreen" style="display:block;">
            <h1 id="examTitleStudent"></h1>
            <p id="examDescriptionStudent" style="white-space: pre-wrap;"></p>
            <div class="form-group"><label for="studentName">ุฃุฏุฎู ุงุณูู ุงููุงูู ูุจุฏุก ุงูุงุฎุชุจุงุฑ</label><input type="text" id="studentName" placeholder="ุงูุงุณู ุงููุงูู"></div>
            <button id="startExamBtn" class="btn">ุจุฏุก ุงูุงุฎุชุจุงุฑ</button>
        </div>
        <div id="examArea">
            <div class="exam-header"><h2 id="welcomeStudent"></h2><div id="timer" class="timer"></div></div>
            <div id="progressBarContainer"><div id="progressBar"></div></div>
            <div id="questionsContainer"></div>
            <div id="navigation-buttons"></div>
            <button id="finishExamBtn" class="btn btn-danger" style="margin-top: 20px; width:100%;">ุฅููุงุก ูุชุณููู ุงูุงุฎุชุจุงุฑ</button>
        </div>
        <div id="resultContainer">
             <h2 id="resultTitle"></h2><p id="resultSummary"></p>
             <div id="reviewContainer"></div>
             <div id="certificate">
                <h2>ุดูุงุฏุฉ ุฅุชูุงู</h2><p>ุชุดูุฏ ูุฐู ุงูุดูุงุฏุฉ ุจุฃู ุงูุทุงูุจ/ุฉ:</p><h3 id="certName"></h3>
                <p>ูุฏ ุฃุชู ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ ูุญุตู/ุช ุนูู ุฏุฑุฌุฉ:</p><h3 id="certScore"></h3>
                <p>ุจุชุงุฑูุฎ: <span id="certDate"></span></p>
            </div>
        </div>
    </div>
</div>
<script>
    const examData = {"config":{"title":"ุงูุชุญุงู ุงููุงููู ุงูุฏููู ุงูุฎุงุต (ุงูุฌูุณูุฉ ูุงูููุทู)","description":"ุชุฌุฑูุจู","layout":"one-by-one","time":5,"shuffle":true,"noGoingBack":true,"disableCheating":true,"monitorTabs":true,"learningMode":false,"singleUseMode":false,"showResults":true,"enableReview":false,"enableCertificate":true,"successPercentage":50,"botToken":"7730074042:AAE7SoB8JraxwYc22_LrCCrSuglqJgMDN7Y","chatId":"152435304"},"questions":[{"text":"ุฃูู ูู ุงูุญุงูุงุช ุงูุขุชูุฉ ุชูุนุชุจุฑ ุชุทุจูููุง ููุจุฏุฃ \"ุญู ุงูุฏู\" ููููุง ููุชุนุฏูู ุงูุฌุฏูุฏ ูู ุงููุงููู ุงูููููุ","choices":["ุฃ) ููููุฏ ูู ุงูููู ูุฃุจููู ุฃุฌูุจููู.","ุจ) ููููุฏ ูู ููุฏู ูุฃู ููููุฉ ูุฃุจ ุจุฑูุทุงูู.","ุฌ) ููููุฏ ูุฃุจููู ูุฌูููู ุงูุฌูุณูุฉ ูู ุงูููู.","ุฏ) ููููุฏ ูุฃุจ ูููู ูุฃู ุฃุฌูุจูุฉ ูู ุฏููุฉ ุฃุฌูุจูุฉ."],"correctAnswer":1},{"text":"ูุง ุงููุฏู ูู ุงุดุชุฑุงุท ุงุณุชูุฑุงุฑ ุงูุฒูุฌูุฉ ููุฏุฉ ุฃุฑุจุน ุณููุงุช ูุงูุชุณุงุจ ุงูุฒูุฌุฉ ุงูุฃุฌูุจูุฉ ุฌูุณูุฉ ุฒูุฌูุง ุงูููููุ","choices":["ุฃ) ุถูุงู ุญุตูู ุงูุฒูุฌุฉ ุนูู ุงูุญูุงูุฉ ุงูุฏุจูููุงุณูุฉ.","ุจ) ุญูุงูุฉ ุงูุฏููุฉ ูู ุงูุชุฒุงูุงุช ูุงููุฉ ุชุฌุงู ุงูุฒูุฌุฉ.","ุฌ) ุชูููู ุงูุฒูุฌุฉ ูู ุงูุชูุฏู ููุธุงุฆู ุญููููุฉ.","ุฏ) ุฅุซุจุงุช ุฑุบุจุฉ ุงูุฒูุฌุฉ ูู ุงูุงุณุชูุฑุงุฑ ูุชุฃููุฏ ุงูุนูุงูุฉ ุงูุฒูุฌูุฉ."],"correctAnswer":3},{"text":"ุฃู ูู ุงูุฎูุงุฑุงุช ุงูุชุงููุฉ ููุนุฏ ุฃุญุฏ ุงูุขุซุงุฑ ุงูุชุทุจูููุฉ ููุชุนุฏูู ุงูุฃุฎูุฑ 2009 ูู ุงููุงุฏุฉ (3/ุฃ) ูู ูุงููู ุงูุฌูุณูุฉ ุงูููููุ","choices":["ุฃ) ููุญ ุงูุฌูุณูุฉ ุชููุงุฆููุง ููู ูู ูููุฏ ูู ุงูููู.","ุจ) ุงููุณุงูุงุฉ ุจูู ุงูุฃู ูุงูุฃุจ ูู ููู ุงูุฌูุณูุฉ.","ุฌ) ุฅูุบุงุก ุงูุฌูุณูุฉ ุนู ูุฒุฏูุฌู ุงูุฌูุณูุฉ.","ุฏ) ุญุฑูุงู ุงูุฃุทูุงู ูุฌูููู ุงููุณุจ ูู ุงูุฌูุณูุฉ."],"correctAnswer":1},{"text":"ุฃู ูู ุงูุดุฑูุท ุงูุชุงููุฉ ููููู ุงูุฅุนูุงุก ููู ุนูุฏ ููุญ ุงูุฌูุณูุฉ ูุฐูู ุงูููุงุกุงุช ุงููุทููุจุฉ ููู ุงููุงุฏุฉ (5)ุ","choices":["ุฃ) ุงูุฅููุงู ุจุงููุบุฉ ุงูุนุฑุจูุฉ.","ุจ) ุจููุบ ุณู ุงูุฑุดุฏ.","ุฌ) ุงูุฅูุงูุฉ ุงููุดุฑูุนุฉ ููุฏุฉ 10 ุณููุงุช.","ุฏ) ุญุณู ุงูุณูุฑุฉ ูุงูุณููู."],"correctAnswer":0},{"text":"ุทูู ูููุฏ ูู ุงูููู ูุฃู ููููุฉ ูุฃุจ ุบูุฑ ูุนุฑููุ ูุง ุงูุฃุณุงุณ ุงููุงูููู ุงูุฐู ูุถูู ูู ุงูุฌูุณูุฉ ุงูููููุฉุ","choices":["ุฃ) ุญู ุงูุฅูููู ููุท.","ุจ) ุญู ุงูุฏู ุงููุนุฏู.","ุฌ) ุงูุชุฌูุณ ุงูุงุถุทุฑุงุฑู.","ุฏ) ุงูุญูุงูุฉ ูู ุงูุนุฏุงู ุงูุฌูุณูุฉ."],"correctAnswer":3},{"text":"ุฃูู ููุง ููู ููุนุฏ ุงููุฑู ุงูุฌููุฑู ุจูู ุงูููุทู ููุญู ุงูุฅูุงูุฉ ูููุงู ูููุงููู ุงูููููุ","choices":["ุฃ) ุงูููุทู ูุงูููู ููุญู ุงูุฅูุงูุฉ ุณูุงุณู.","ุจ) ุงูููุทู ูุคูุช ูุงูุฅูุงูุฉ ุฏุงุฆูุฉ.","ุฌ) ุงูููุทู ูุฑุชุจุท ุจููุฉ ุงูุจูุงุกุ ูุงูุฅูุงูุฉ ุจุบุฑุถ ูุคูุช.","ุฏ) ุงูููุทู ูุฑุชุจุท ุจุงูุณูู ูุงูุฅูุงูุฉ ูุฑุชุจุทุฉ ุจุงูุฌูุณูุฉ."],"correctAnswer":2},{"text":"ูุง ููุน ุงูููุทู ุงูุฐู ููุฑุถู ุงููุงููู ุนูู ุนุฏููู ุงูุฃูููุฉ ุฃู ูุงูุตููุง ูู ุงูุชุดุฑูุน ุงูููููุ","choices":["ุฃ) ุงูููุทู ุงูุฎุงุต.","ุจ) ุงูููุทู ุงูุนุงู.","ุฌ) ุงูููุทู ุงูุฅููููู.","ุฏ) ุงูููุทู ุงููุงูููู."],"correctAnswer":3},{"text":"ูููุงู ููุงุชุฌุงู ุงูุฃูู ูู ุงูููู ุงูููููุ ูุง ุดุฑุท ุงูุชุณุงุจ ุงูุฃุฌูุจู ููุทูุงู ูู ุงููููุ","choices":["ุฃ) ุงูุญุตูู ุนูู ุนูุฏ ุนูู.","ุจ) ุงูุฅูุงูุฉ ูู ุงูููู ุฃูุซุฑ ูู 5 ุณููุงุช.","ุฌ) ุงูุฅูุงูุฉ ุงููุงููููุฉ ุจุฅุฐู ุงูุณูุทุงุช.","ุฏ) ุฅุซุจุงุช ุงูููุฉ ูู ุงูุฒูุงุฌ ูู ููุงุทู ูููู."],"correctAnswer":1},{"text":"ุนูุฏ ุนุฏู ุงุฎุชูุงุฑ ุงูุฃุทุฑุงู ููุงููู ูุญูู ุงูุชุฒุงูุงุชูู ุงูุชุนุงูุฏูุฉุ ููุทุจู ุงููุงููู ุจูุงุกู ุนูู:","choices":["ุฃ) ุฌูุณูุฉ ุงููุฏุนู.","ุจ) ูุงููู ุจูุฏ ุชูููุน ุงูุนูุฏ.","ุฌ) ูุงููู ููุทู ุงููุฏุนู ุนููู.","ุฏ) ุงููุงููู ุงููููู ุชููุงุฆูุงู."],"correctAnswer":2},{"text":"ูุง ุนูุงูุฉ ุงูููุทู ุจุชูููุฐ ุงูุฃุญูุงู ุงูุฃุฌูุจูุฉ ูู ุงููููุ","choices":["ุฃ) ููููุฐ ุงูุญูู ุจูุงุกู ุนูู ุงูููุทู ูู ุจูุฏ ุงูุญูู ููุท.","ุจ) ูุง ูุดุชุฑุท ุฃู ุงุฑุชุจุงุท ุจุงูููุทู ูุชูููุฐ ุงูุญูู.","ุฌ) ูุฌุจ ุงูุชุญูู ูู ุงุฎุชุตุงุต ุงููุญููุฉ ุงูุฃุฌูุจูุฉ ุจูุงุก ุนูู ููุทู ุงููุฏุนู ุนููู.","ุฏ) ุชูููุฐ ุงูุฃุญูุงู ุชููุงุฆูุงู ุฅุฐุง ูุงูุช ุตุงุฏุฑุฉ ูู ุฏููุฉ ุนุฑุจูุฉ."],"correctAnswer":2}]};
    let studentName = '', studentAnswers = new Array(examData.questions.length).fill(null), timerInterval, heartbeatInterval, currentQuestionIndex = 0, tabSwitchCount = 0;
    const startScreen = document.getElementById('startScreen'), examArea = document.getElementById('examArea'), resultContainer = document.getElementById('resultContainer');
    
    window.onload = function() {
        const uniqueExamId = `examStarted_${btoa(unescape(encodeURIComponent(examData.config.title)))}`;
        if (examData.config.singleUseMode && localStorage.getItem(uniqueExamId)) {
            document.body.innerHTML = `<div class="container" style="text-align:center;"><h1>ุชู ููู ุงูุงุฎุชุจุงุฑ</h1><p>ููุฏ ููุช ุจุจุฏุก ูุฐุง ุงูุงุฎุชุจุงุฑ ุจุงููุนู ูู ูุฐุง ุงููุชุตูุญ. ูุง ููููู ุฅุฌุฑุงุคู ูุฑุฉ ุฃุฎุฑู.</p></div>`;
            return;
        }
        document.getElementById('examTitleStudent').textContent = examData.config.title;
        document.getElementById('examDescriptionStudent').textContent = examData.config.description;
        document.getElementById('startExamBtn').addEventListener('click', () => {
            studentName = document.getElementById('studentName').value.trim();
            if (studentName) startTheExam(); else alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู.');
        });
    };
    
    function startTheExam() {
        if (examData.config.singleUseMode) {
             const uniqueExamId = `examStarted_${btoa(unescape(encodeURIComponent(examData.config.title)))}`;
             localStorage.setItem(uniqueExamId, 'true');
        }
        startScreen.style.display = 'none'; examArea.style.display = 'block';
        document.getElementById('welcomeStudent').textContent = `ุจุงูุชููููุ ${studentName}!`;
        if (examData.config.time > 0) startTimer(examData.config.time * 60); else document.getElementById('timer').style.display = 'none';
        if (examData.config.shuffle) { examData.questions.sort(() => Math.random() - 0.5); }
        setupSmartFeatures(); renderQuestionsForStudent();
        document.getElementById('finishExamBtn').addEventListener('click', () => { if(confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุฅููุงุก ุงูุงุฎุชุจุงุฑุ")) finishTheExam(); });
        
        // **[ุชุนุฏูู 1: ุฅุถุงูุฉ ุฑุณุงูุฉ ุชุญุฐูุฑ ุฃูุซุฑ ูุนุงููุฉ ุนูุฏ ุฅุบูุงู ุงูุตูุญุฉ]**
        window.addEventListener('beforeunload', (event) => {
            if (examArea.style.display === 'block') { // Make sure the exam is running
                event.preventDefault();
                event.returnValue = 'ุณูุชู ุฅููุงุก ุงุฎุชุจุงุฑู ุชููุงุฆููุง ุฅุฐุง ุบุงุฏุฑุช. ูู ุฃูุช ูุชุฃูุฏุ';
            }
        });

        // **[ุชุนุฏูู 2: ุจุฏุก ุฅุฑุณุงู ูุจุถุงุช ุฅูู Telegram ููุญุงูุงุฉ ุชุชุจุน ุงูุฎุงุฏู]**
        startHeartbeat();
    }
    
    function renderQuestionsForStudent() {
        const container = document.getElementById('questionsContainer'); container.innerHTML = '';
        if (examData.config.layout === 'one-by-one') { renderSingleQuestion(currentQuestionIndex); updateNavigationButtons(); } 
        else { examData.questions.forEach((q, index) => container.appendChild(createQuestionElement(q, index))); }
        updateProgressBar();
    }
    function createQuestionElement(q, index) {
        const qElem = document.createElement('div'); qElem.className = 'question-card'; qElem.id = `question-${index}`;
        const choicesHTML = q.choices.map((choice, i) => `<li onclick="handleChoiceClick(${index}, ${i}, this)"><input type="radio" name="q${index}" id="q${index}c${i}" value="${i}" ${studentAnswers[index] === i ? 'checked' : ''}><label for="q${index}c${i}">${choice}</label></li>`).join('');
        qElem.innerHTML = `<h3>ุงูุณุคุงู ${index + 1}: ${q.text}</h3><ul class="choices">${choicesHTML}</ul>`;
        return qElem;
    }
    function handleChoiceClick(qIndex, cIndex, liElement) {
        studentAnswers[qIndex] = cIndex;
        liElement.querySelector('input').checked = true;
        if (examData.config.layout === 'one-by-one' && examData.config.learningMode) {
            const isCorrect = (cIndex === examData.questions[qIndex].correctAnswer);
            const choices = liElement.parentElement.querySelectorAll('li');
            choices.forEach(item => { item.style.pointerEvents = 'none'; item.classList.remove('correct', 'incorrect'); });
            liElement.classList.add(isCorrect ? 'correct' : 'incorrect');
        }
        updateProgressBar();
    }
    function renderSingleQuestion(index) { document.getElementById('questionsContainer').appendChild(createQuestionElement(examData.questions[index], index)); }
    function updateNavigationButtons() {
        const nav = document.getElementById('navigation-buttons');
        if (examData.config.layout !== 'one-by-one') { nav.style.display = 'none'; return; }
        let prevButtonHTML = '';
        if (!examData.config.noGoingBack) { prevButtonHTML = `<button id="prevBtn" class="btn">ุงูุณุงุจู</button>`; }
        nav.innerHTML = `${prevButtonHTML}<button id="nextBtn" class="btn">ุงูุชุงูู</button>`;
        const nextBtn = document.getElementById('nextBtn');
        nextBtn.disabled = currentQuestionIndex === examData.questions.length - 1;
        nextBtn.addEventListener('click', () => { if (currentQuestionIndex < examData.questions.length - 1) { currentQuestionIndex++; renderQuestionsForStudent(); } });
        if (!examData.config.noGoingBack) {
            const prevBtn = document.getElementById('prevBtn');
            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.addEventListener('click', () => { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestionsForStudent(); } });
        }
    }
    function updateProgressBar() {
        const answered = studentAnswers.filter(a => a !== null).length, progress = (answered / examData.questions.length) * 100;
        const bar = document.getElementById('progressBar'); bar.style.width = `${progress}%`; bar.textContent = `${Math.round(progress)}%`;
    }
    function setupSmartFeatures() {
        if (examData.config.disableCheating) { ['contextmenu', 'copy', 'paste'].forEach(evt => document.body.addEventListener(evt, e => e.preventDefault())); }
        if (examData.config.monitorTabs) { document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') tabSwitchCount++; }); }
    }
    async function finishTheExam() {
        clearInterval(timerInterval); 
        // **[ุชุนุฏูู 3: ุฅููุงู ูุจุถุงุช Telegram ุนูุฏ ุงูุชูุงุก ุงูุงุฎุชุจุงุฑ ุจุดูู ุทุจูุนู]**
        clearInterval(heartbeatInterval); 
        examArea.style.display = 'none'; resultContainer.style.display = 'block';
        let score = 0; studentAnswers.forEach((answer, i) => { if (answer === examData.questions[i].correctAnswer) score++; });
        const total = examData.questions.length;
        document.getElementById('resultTitle').textContent = 'ุชู ุงูุงูุชูุงุก ูู ุงูุงูุชุญุงู!';
        if (examData.config.showResults) {
            let summary = `ูุฑุญุจุงู ${studentName}ุ ูุชูุฌุชู ูู: <strong>${score} / ${total}</strong>`;
            if (examData.config.monitorTabs && tabSwitchCount > 0) summary += `<br><small style="color:var(--danger-color);">ุชู ุชุณุฌูู ุฎุฑูุฌู ูู ุงูุตูุญุฉ ${tabSwitchCount} ูุฑุงุช.</small>`;
            document.getElementById('resultSummary').innerHTML = summary;
        } else { document.getElementById('resultSummary').textContent = "ุดูุฑุงู ููุ ุชู ุชุณููู ุฅุฌุงุจุงุชู ุจูุฌุงุญ."; }
        if (examData.config.showResults && examData.config.enableReview) renderReview();
        if (examData.config.enableCertificate && (score / total * 100) >= examData.config.successPercentage) renderCertificate(score, total);
        if (examData.config.botToken && examData.config.chatId) await sendResultsToTelegram(score, total);
    }
    function renderReview() {
        const container = document.getElementById('reviewContainer'); container.innerHTML = '<h3>ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช:</h3>';
        examData.questions.forEach((q, i) => {
            const isCorrect = studentAnswers[i] === q.correctAnswer;
            container.innerHTML += `<div class="question-card" style="background:${isCorrect ? '#d4edda' : '#f8d7da'};"><p><strong>${q.text}</strong></p><p>ุฅุฌุงุจุชู: ${studentAnswers[i] !== null ? q.choices[studentAnswers[i]] : "ูู ุชุชู ุงูุฅุฌุงุจุฉ"} ${isCorrect ? 'โ๏ธ' : 'โ'}</p>${!isCorrect ? `<p style="color:var(--primary-color);">ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ${q.choices[q.correctAnswer]}</p>` : ''}</div>`;
        });
    }
    function renderCertificate(score, total) {
        const cert = document.getElementById('certificate'); cert.style.display = 'block';
        document.getElementById('certName').textContent = studentName; document.getElementById('certScore').textContent = `${score} / ${total}`;
        document.getElementById('certDate').textContent = new Date().toLocaleDateString('ar-EG');
    }
    function startTimer(duration) {
        let timer = duration; const el = document.getElementById('timer');
        timerInterval = setInterval(() => {
            let m = parseInt(timer / 60, 10), s = parseInt(timer % 60, 10);
            m = m < 10 ? "0" + m : m; s = s < 10 ? "0" + s : s; el.textContent = `${m}:${s}`;
            if (--timer < 0) { clearInterval(timerInterval); alert('ุงูุชูู ุงูููุช!'); finishTheExam(); }
        }, 1000);
    }
    async function sendResultsToTelegram(score, total) {
        const { botToken, chatId, title } = examData.config;
        let msg = `*๐ ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุฌุฏูุฏุฉ*\n\n*ุงูุงุฎุชุจุงุฑ:* ${title}\n*ุงูุทุงูุจ:* ${studentName}\n*ุงููุชูุฌุฉ:* ${score} ูู ${total}\n*ูุฑุงุช ุงูุฎุฑูุฌ:* ${tabSwitchCount}`;
        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
        try {
            const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: chatId, text: msg, parse_mode: 'Markdown' }), keepalive: true });
            if (!res.ok) console.error("Telegram API error:", await res.json());
        } catch (error) { console.error("Fetch error:", error); }
    }
    
    // **[ุชุนุฏูู 4: ุฏุงูุฉ ุฌุฏูุฏุฉ ูุฅุฑุณุงู ูุจุถุงุช ุญูุฉ ุฅูู Telegram]**
    function startHeartbeat() {
        const heartbeatIntervalInSeconds = 30; // ุฅุฑุณุงู ูุจุถุฉ ูู 30 ุซุงููุฉ
        const { botToken, chatId, title } = examData.config;
        if (!botToken || !chatId) return;

        heartbeatInterval = setInterval(() => {
            const message = `ูุจุถ ุญู: ุงูุทุงูุจ ${studentName} ูุง ูุฒุงู ูู ุงูุงุฎุชุจุงุฑ.`;
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
            const requestBody = JSON.stringify({ chat_id: chatId, text: message });

            // Using keepalive allows the request to be sent even if the page closes
            navigator.sendBeacon(url, requestBody);
        }, heartbeatIntervalInSeconds * 1000);
    }
</script>
<footer style="text-align: center; margin-top: 20px; padding: 10px; background-color: #f1f1f1; position: fixed; bottom: 0; width: 100%;">
       2025 ยฉ Copyright Jamal-Alshami
    </footer>
</body>
</html>
