
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø®Ø§Øµ (Ø§Ù„Ø¬Ù†Ø³ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ·Ù†)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #0056b3; --secondary-color: #007bff; --light-gray: #f8f9fa; --dark-gray: #343a40; --success-color: #28a745; --danger-color: #dc3545; --background-color: #e9ecef; --text-color: #212529; --white: #fff; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--background-color); margin: 0; padding: 20px; color: var(--text-color); direction: rtl; }
        .container { background-color: var(--white); border-radius: 15px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); width: 95%; max-width: 900px; margin: 0 auto; padding: 30px; }
        h1, h2, h3 { color: var(--dark-gray); font-weight: 700; }
        .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input[type="text"], .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { background-color: var(--primary-color); color: var(--white); border: none; padding: 12px 25px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        .btn:hover { background-color: #004a99; } .btn:disabled { background-color: #ccc; }
        .btn-danger { background-color: var(--danger-color); }
        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
        .timer { font-size: 1.2em; color: var(--danger-color); font-weight: bold; }
        .question-card { background: var(--light-gray); border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: right; }
        .question-card ul { list-style: none; padding: 0; }
        .choices li { padding: 10px; margin: 8px 0; background: var(--white); border: 1px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .choices li:hover { background-color: #e3f2fd; }
        .choices li.correct { background-color: #d4edda !important; border-color: #c3e6cb; }
        .choices li.incorrect { background-color: #f8d7da !important; border-color: #f5c6cb; }
        .essay-answer { width: 100%; min-height: 120px; resize: vertical; margin-top: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        #navigation-buttons { display: flex; justify-content: space-between; margin-top: 20px; }
        #progressBarContainer { width: 100%; background-color: #e9ecef; border-radius: 20px; margin-bottom: 25px; overflow: hidden; }
        #progressBar { width: 0%; height: 20px; background-color: var(--success-color); border-radius: 20px; transition: width 0.5s; text-align: center; color: white; line-height: 20px; }
        #certificate { display: none; border: 5px solid var(--primary-color); padding: 30px; margin-top: 30px; text-align: center; background: linear-gradient(135deg, #f9f9f9, #eef8ff); }
        #startScreen, #examArea, #resultContainer { display: none; }
    </style>
</head>
<body>
<div class="container">
    <div id="studentExamView" style="display:block;">
        <div id="startScreen" style="display:block;">
            <h1 id="examTitleStudent"></h1>
            <p id="examDescriptionStudent" style="white-space: pre-wrap;"></p>
            <div class="form-group"><label for="studentName">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label><input type="text" id="studentName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>
            <button id="startExamBtn" class="btn">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
        <div id="examArea">
            <div class="exam-header"><h2 id="welcomeStudent"></h2><div id="timer" class="timer"></div></div>
            <div id="progressBarContainer"><div id="progressBar"></div></div>
            <div id="questionsContainer"></div>
            <div id="navigation-buttons"></div>
            <button id="finishExamBtn" class="btn btn-danger" style="margin-top: 20px; width:100%;">Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
        <div id="resultContainer">
             <h2 id="resultTitle"></h2><p id="resultSummary"></p>
             <div id="reviewContainer"></div>
             <div id="certificate">
                <h2>Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù…</h2><p>ØªØ´Ù‡Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©:</p><h3 id="certName"></h3>
                <p>Ù‚Ø¯ Ø£ØªÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ØµÙ„/Øª Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©:</p><h3 id="certScore"></h3>
                <p>Ø¨ØªØ§Ø±ÙŠØ®: <span id="certDate"></span></p>
            </div>
        </div>
    </div>
</div>
<script>
    const examData = {
  "config": {
    "title": "Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø®Ø§Øµ (Ø§Ù„Ø¬Ù†Ø³ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ·Ù†)",
    "description": "ØªØ¬Ø±ÙŠØ¨ÙŠ",
    "layout": "one-by-one",
    "time": 7,
    "shuffle": true,
    "noGoingBack": true,
    "disableCheating": true,
    "monitorTabs": true,
    "learningMode": false,
    "singleUseMode": false,
    "showResults": true,
    "enableReview": false,
    "enableCertificate": true,
    "successPercentage": 50,
    "botToken": "7730074042:AAE7SoB8JraxwYc22_LrCCrSuglqJgMDN7Y",
    "chatId": "152435304"
  },
  "questions": [
    {
      "type": "mcq",
      "text": "ÙˆÙÙ‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ÙŠÙ…Ù†ÙŠØŒ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø°ÙŠ ÙŠÙØ¹Ø«Ø± Ø¹Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„ÙŠÙ…Ù† ÙˆÙ„Ø§ ÙŠÙØ¹Ø±Ù ÙˆØ§Ù„Ø¯Ø§Ù‡ ÙŠÙÙ…Ù†Ø­ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³:",
      "choices": [
        "Ø£. Ø§Ù„ØªØ¬Ù†Ø³.",
        "Ø¨. Ø­Ù‚ Ø§Ù„Ø¯Ù….",
        "Ø¬. Ø­Ù‚ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ….",
        "Ø¯. Ø§Ù„ØªØ¨Ø¹ÙŠØ©."
      ],
      "correctAnswer": 2
    },
    {
      "type": "mcq",
      "text": "Ø£ÙŠ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ØªØ³Ù…Ø­ Ø¨Ø³Ø­Ø¨ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù‚ÙŠØ¯ Ø²Ù…Ù†ÙŠØŸ",
      "choices": [
        "Ø£. Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø¹Ù† Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© Ù„Ù…Ø¯Ø© Ø³Ù†ØªÙŠÙ†.",
        "Ø¨. Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© Ù„Ø¯ÙˆÙ„Ø© Ø£Ø¬Ù†Ø¨ÙŠØ© Ø¯ÙˆÙ† ØªØ±Ø®ÙŠØµ.",
        "Ø¬. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„ØºØ´.",
        "Ø¯. Ø§Ù„Ø­ÙƒÙ… ÙÙŠ Ø¬Ø±ÙŠÙ…Ø© Ù…Ø®Ù„Ø© Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù… Ø¨Ø¹Ø¯ Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ¬Ù†Ø³."
      ],
      "correctAnswer": 1
    },
    {
      "type": "mcq",
      "text": "Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¹Ù† Ø´Ø®Øµ Ù…ØªØ¬Ù†Ø³ Ù‡Ùˆ:",
      "choices": [
        "Ø£. Ø²ÙˆØ§Ù„ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¹Ù†Ù‡ ÙˆØ¹Ù† Ø¬Ù…ÙŠØ¹ Ø£ÙØ±Ø§Ø¯ Ø£Ø³Ø±ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
        "Ø¨. Ø²ÙˆØ§Ù„ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø¹Ù†Ù‡ ÙÙ‚Ø·ØŒ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø´Ù…ÙˆÙ„ Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ†.",
        "Ø¬. Ø¨Ø·Ù„Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø²ÙˆØ§Ø¬ ÙˆØ§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø¨Ø±Ù…Ù‡Ø§.",
        "Ø¯. Ø¹Ø¯Ù… ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù† Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø±Ø©."
      ],
      "correctAnswer": 1
    },
    {
      "type": "mcq",
      "text": "Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ© Ù„Ù„Ù…Ø±Ø£Ø© Ù…Ø´Ø±ÙˆØ· Ø¨Ù€:",
      "choices": [
        "Ø£. Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© ÙÙŠ Ø§Ù„ÙŠÙ…Ù† Ø®Ù…Ø³ Ø³Ù†ÙˆØ§Øª.",
        "Ø¨. ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ù„ÙˆØ²ÙŠØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©.",
        "Ø¬. Ø§Ù„ØªØ®Ù„ÙŠ Ø¹Ù† Ø¬Ù†Ø³ÙŠØ© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡.",
        "Ø¯. Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ©."
      ],
      "correctAnswer": 3
    },
    {
      "type": "mcq",
      "text": "Ø¥Ø°Ø§ ØªØ¬Ù†Ø³ ÙŠÙ…Ù†ÙŠ Ø¨Ø¬Ù†Ø³ÙŠØ© Ø£Ø¬Ù†Ø¨ÙŠØ© Ø¯ÙˆÙ† Ø¥Ø°Ù† Ø§Ù„ÙˆØ²ÙŠØ±ØŒ ÙØ¥Ù† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†:",
      "choices": [
        "Ø£. Ù„Ø§ ÙŠØ¹ØªØ±Ù Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ© ÙˆÙŠØ³ØªÙ…Ø± ÙÙŠ Ù…Ø¹Ø§Ù…Ù„ØªÙ‡ ÙƒÙŠÙ…Ù†ÙŠ.",
        "Ø¨. ÙŠØ³Ù‚Ø· Ø¹Ù†Ù‡ Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ© ÙÙˆØ±Ø§Ù‹.",
        "Ø¬. ÙŠÙ…Ù†Ø­Ù‡ ÙØ±ØµØ© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø³ÙŠØªÙŠÙ†.",
        "Ø¯. ÙŠÙ…Ù†Ø¹Ù‡ Ù…Ù† Ù…Ù…Ø§Ø±Ø³Ø© Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚Ù‡ Ø§Ù„Ù…Ø¯Ù†ÙŠØ©."
      ],
      "correctAnswer": 0
    },
    {
      "type": "mcq",
      "text": "ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø®Ø§ØµØŒ Ø§Ù„Ù…ÙˆØ·Ù† ÙŠÙ…Ø«Ù„:",
      "choices": [
        "Ø£. Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙÙˆÙ„Ø¯ ÙÙŠÙ‡ Ø§Ù„Ø´Ø®Øµ.",
        "Ø¨. Ø±Ø§Ø¨Ø·Ø© Ø¨ÙŠÙ† Ø§Ù„Ø´Ø®Øµ ÙˆØ¥Ù‚Ù„ÙŠÙ… Ø§Ù„Ø¯ÙˆÙ„Ø©.",
        "Ø¬. Ù…Ø¬Ø±Ø¯ Ù…ÙƒØ§Ù† Ù„Ù„Ø¹Ù…Ù„.",
        "Ø¯. Ù…Ø­Ù„ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©."
      ],
      "correctAnswer": 1
    },
    {
      "type": "mcq",
      "text": "Ù…Ù† Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ø®Ø§Øµ:",
      "choices": [
        "Ø£. Ù…Ø­Ù„ Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ.",
        "Ø¨. Ù…Ø­Ù„ Ø¥Ù‚Ø§Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡.",
        "Ø¬. Ù…Ø­Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯.",
        "Ø¯. Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„ØªÙ†ÙÙŠØ° Ø¹Ù‚Ø¯ ."
      ],
      "correctAnswer": 3
    },
    {
      "type": "mcq",
      "text": "Ø§Ù„Ø£Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…ØªÙˆØ·Ù†ÙˆÙ† ÙÙŠ Ø§Ù„ÙŠÙ…Ù† ÙŠØªÙ…ØªØ¹ÙˆÙ† Ø¹Ø§Ø¯Ø© Ø¨Ù€:",
      "choices": [
        "Ø£. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø³ÙŠØ§Ø³ÙŠØ©.",
        "Ø¨. Ø§Ù„Ø¬Ù†Ø³ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.",
        "Ø¬. Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù…Ù† Ø£ÙŠ Ø§Ù„ØªØ²Ø§Ù… Ù‚Ø§Ù†ÙˆÙ†ÙŠ.",
        "Ø¯. Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©."
      ],
      "correctAnswer": 3
    },
    {
      "type": "mcq",
      "text": "Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ø¹Ø§Ù… ÙŠØ³Ù…Ù‰ Ø£ÙŠØ¶Ù‹Ø§:",
      "choices": [
        "Ø£. Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ.",
        "Ø¨. Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠ.",
        "Ø¬. Ø§Ù„Ù…ÙˆØ·Ù† Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ.",
        "Ø¯. Ø§Ù„Ù…ÙˆØ·Ù† ØºÙŠØ± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ."
      ],
      "correctAnswer": 1
    },
    {
      "type": "mcq",
      "text": "ÙŠÙ…ÙŠØ² Ø§Ù„Ù…Ø´Ø±Ø¹ Ø§Ù„ÙŠÙ…Ù†ÙŠ Ø¨ÙŠÙ† \"Ø§Ù„Ù…ÙˆØ·Ù†\" Ùˆ\"Ù…Ø­Ù„ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©\" Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³:",
      "choices": [
        "Ø£. Ø§Ù„ÙˆØ³Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ.",
        "Ø¨. Ù…Ø¯Ø© Ø¹Ù‚Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±.",
        "Ø¬. Ù†ÙŠØ© Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±.",
        "Ø¯. Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ."
      ],
      "correctAnswer": 2
    }
  ]
};
    let studentName = '', studentAnswers = new Array(examData.questions.length).fill(null), timerInterval, currentQuestionIndex = 0, tabSwitchCount = 0;
    const startScreen = document.getElementById('startScreen'), examArea = document.getElementById('examArea'), resultContainer = document.getElementById('resultContainer');
    
    window.onload = function() {
        const uniqueExamId = `examStarted_${btoa(unescape(encodeURIComponent(examData.config.title)))}`;
        if (examData.config.singleUseMode && localStorage.getItem(uniqueExamId)) {
            document.body.innerHTML = `<div class="container" style="text-align:center;"><h1>ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1><p>Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¨Ø¯Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­. Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¬Ø±Ø§Ø¤Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p></div>`;
            return;
        }
        document.getElementById('examTitleStudent').textContent = examData.config.title;
        document.getElementById('examDescriptionStudent').textContent = examData.config.description;
        document.getElementById('startExamBtn').addEventListener('click', () => {
            studentName = document.getElementById('studentName').value.trim();
            if (studentName) startTheExam(); else alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ.');
        });
    };
    
    function startTheExam() {
        if (examData.config.singleUseMode) {
             const uniqueExamId = `examStarted_${btoa(unescape(encodeURIComponent(examData.config.title)))}`;
             localStorage.setItem(uniqueExamId, 'true');
        }
        startScreen.style.display = 'none'; examArea.style.display = 'block';
        document.getElementById('welcomeStudent').textContent = `Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ØŒ ${studentName}!`;
        if (examData.config.time > 0) startTimer(examData.config.time * 60); else document.getElementById('timer').style.display = 'none';
        if (examData.config.shuffle) { examData.questions.sort(() => Math.random() - 0.5); }
        setupSmartFeatures(); renderQuestionsForStudent();
        document.getElementById('finishExamBtn').addEventListener('click', () => { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ")) finishTheExam(); });
    }
    
    function renderQuestionsForStudent(){const container=document.getElementById("questionsContainer");container.innerHTML="",examData.config.layout==="one-by-one"?(renderSingleQuestion(currentQuestionIndex),updateNavigationButtons()):examData.questions.forEach((e,t)=>container.appendChild(createQuestionElement(e,t))),updateProgressBar()}function createQuestionElement(e,t){const n=document.createElement("div");n.className="question-card",n.id=`question-${t}`;let o=`<h3>Ø§Ù„Ø³Ø¤Ø§Ù„ ${t+1}: ${e.text}</h3>`;if("mcq"===e.type){const i=e.choices.map((e,n)=>`<li onclick="handleChoiceClick(${t}, ${n}, this)"><input type="radio" name="q${t}" id="q${t}c${n}" value="${n}" ${studentAnswers[t]===n?"checked":""}><label for="q${t}c${n}">${e}</label></li>`).join("");o+=`<ul class="choices">${i}</ul>`}else{const s=studentAnswers[t]||"";o+=`<textarea class="essay-answer" oninput="handleEssayInput(${t}, this.value)" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§...">${s}</textarea>`}return n.innerHTML=o,n}function handleChoiceClick(e,t,n){studentAnswers[e]=t,n.querySelector("input").checked=!0,examData.config.layout==="one-by-one"&&examData.config.learningMode&&"mcq"===examData.questions[e].type&&((n.classList.add(t===examData.questions[e].correctAnswer?"correct":"incorrect"),n.parentElement.querySelectorAll("li").forEach(e=>{e.style.pointerEvents="none"}))),updateProgressBar()}function handleEssayInput(e,t){studentAnswers[e]=t.trim(),updateProgressBar()}function renderSingleQuestion(e){document.getElementById("questionsContainer").appendChild(createQuestionElement(examData.questions[e],e))}function updateNavigationButtons(){const e=document.getElementById("navigation-buttons");if("one-by-one"!==examData.config.layout)return void(e.style.display="none");let t="";examData.config.noGoingBack||(t='<button id="prevBtn" class="btn">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>'),e.innerHTML=`${t}<button id="nextBtn" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>`;const n=document.getElementById("nextBtn");n.disabled=currentQuestionIndex===examData.questions.length-1,n.addEventListener("click",()=>{currentQuestionIndex<examData.questions.length-1&&(currentQuestionIndex++,renderQuestionsForStudent())}),examData.config.noGoingBack||(document.getElementById("prevBtn").disabled=0===currentQuestionIndex,document.getElementById("prevBtn").addEventListener("click",()=>{currentQuestionIndex>0&&(currentQuestionIndex--,renderQuestionsForStudent())}))}function updateProgressBar(){const e=studentAnswers.filter(e=>null!==e&&""!==e).length,t=e/examData.questions.length*100,n=document.getElementById("progressBar");n.style.width=`${t}%`,n.textContent=`${Math.round(t)}%`}function setupSmartFeatures(){examData.config.disableCheating&&["contextmenu","copy","paste"].forEach(t=>document.body.addEventListener(t,e=>e.preventDefault())),examData.config.monitorTabs&&document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&"block"!==resultContainer.style.display&&tabSwitchCount++})}async function finishTheExam(){clearInterval(timerInterval),examArea.style.display="none",resultContainer.style.display="block";let e=0,t=0;if(examData.questions.forEach((n,o)=>{("mcq"===n.type&&(t++,studentAnswers[o]===n.correctAnswer&&e++))}),document.getElementById("resultTitle").textContent="ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†!",examData.config.showResults){let n=`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${studentName}ØŒ Ù†ØªÙŠØ¬ØªÙƒ ÙÙŠ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ Ù‡ÙŠ: <strong>${e} / ${t}</strong>`;examData.questions.some(e=>"essay"===e.type)&&(n+='<br><small>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ© ØªØªØ·Ù„Ø¨ ØªØµØ­ÙŠØ­Ù‹Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙˆØ³ØªØ¸Ù‡Ø± Ù†ØªÙŠØ¬ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.</small>'),examData.config.monitorTabs&&tabSwitchCount>0&&(n+=`<br><small style="color:var(--danger-color);">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù…Ù† Ø§Ù„ØµÙØ­Ø© ${tabSwitchCount} Ù…Ø±Ø§Øª.</small>`),document.getElementById("resultSummary").innerHTML=n}else document.getElementById("resultSummary").textContent="Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒØŒ ØªÙ… ØªØ³Ù„ÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­.";examData.config.showResults&&examData.config.enableReview&&renderReview(),examData.config.enableCertificate&&t>0&&e/t*100>=examData.config.successPercentage&&renderCertificate(e,t),examData.config.botToken&&examData.config.chatId&&await sendResultsToTelegram(e,t)}function renderReview(){const e=document.getElementById("reviewContainer");e.innerHTML="<h3>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:</h3>",examData.questions.forEach((t,n)=>{let o="";o="mcq"===t.type?`<div class="question-card" style="background:${studentAnswers[n]===t.correctAnswer?"#d4edda":"#f8d7da"};"><p><strong>${t.text}</strong></p><p>Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${null!==studentAnswers[n]?t.choices[studentAnswers[n]]:"Ù„Ù… ØªØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©"} ${studentAnswers[n]===t.correctAnswer?"âœ”ï¸":"âŒ"}</p>${studentAnswers[n]!==t.correctAnswer?`<p style="color:var(--primary-color);">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${t.choices[t.correctAnswer]}</p>`:""}</div>`:`<div class="question-card" style="background: #e9ecef;"><p><strong>(Ø³Ø¤Ø§Ù„ Ù…Ù‚Ø§Ù„ÙŠ) ${t.text}</strong></p><p style="font-weight:bold;">Ø¥Ø¬Ø§Ø¨ØªÙƒ:</p><p style="white-space: pre-wrap; background: #fff; padding:10px; border-radius:5px;">${studentAnswers[n]?studentAnswers[n].replace(/</g,"&lt;").replace(/>/g,"&gt;"):"Ù„Ù… ØªØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©"}</p></div>`,e.innerHTML+=o})}function renderCertificate(e,t){const n=document.getElementById("certificate");n.style.display="block",document.getElementById("certName").textContent=studentName,document.getElementById("certScore").textContent=`${e} / ${t}`,document.getElementById("certDate").textContent=(new Date).toLocaleDateString("ar-EG")}function startTimer(e){let t=e;const n=document.getElementById("timer");timerInterval=setInterval(()=>{let e=parseInt(t/60,10),o=parseInt(t%60,10);e=e<10?"0"+e:e,o=o<10?"0"+o:o,n.textContent=`${e}:${o}`,--t<0&&(clearInterval(timerInterval),alert("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!"),finishTheExam())},1e3)}async function sendResultsToTelegram(e,t){const{botToken:n,chatId:o,title:s}=examData.config;if(!n||!o)return;function i(e){return"string"!=typeof e?"":e.replace(/([_*[\]()~>#+\-=|{}.!])/g,"\\$1")}let a=`*ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯Ø©*\n\n*Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:* ${i(s)}\n*Ø§Ù„Ø·Ø§Ù„Ø¨:* ${i(studentName)}\n*Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯:* ${e} Ù…Ù† ${t}\n*Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬:* ${tabSwitchCount}`;let d="\n\n*Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ©*",r=!1;examData.questions.forEach((e,t)=>{("essay"===e.type&&(r=!0,d+=`\n\n*â“ Ø§Ù„Ø³Ø¤Ø§Ù„: ${i(e.text)}*\n*ğŸ“ Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø·Ø§Ù„Ø¨:*\n${i(studentAnswers[t]||"Ù„Ù… ØªØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©")}`))}),r&&(a+=d);const c=`https://api.telegram.org/bot${n}/sendMessage`;try{a.length>4096&&(a=a.substring(0,4e3)+"\n\n... (ØªÙ… Ø§Ù‚ØªØ·Ø§Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø£Ù†Ù‡Ø§ Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹)");const l=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,text:a,parse_mode:"MarkdownV2"})});l.ok||console.error("Telegram API Error:",await l.json())}catch(p){console.error("Fetch error or issue sending to Telegram:",p)}}
</script>
</body>
</html>
