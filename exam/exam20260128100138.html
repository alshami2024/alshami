
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชูุงุฒุน ุงูููุงููู ูู ุงููุงููู ุงูุฏููู ุงูุฎุงุต</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #0056b3; --bg-color: #e9ecef; --white: #fff; --danger: #dc3545; --success: #28a745; --warning: #ffc107; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg-color); margin: 0; padding: 15px; direction: rtl; line-height: 1.6; }
        .container { background-color: var(--white); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 850px; margin: 0 auto; padding: 25px; min-height: 80vh; position: relative; z-index: 10; }
        .btn { background: var(--primary-color); color: #fff; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-family: inherit; margin: 5px; font-weight: bold; transition: 0.3s; width: 100%; font-size: 1.1rem; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-danger { background: var(--danger); }
        .btn-success { background: var(--success); }
        .question-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; padding: 20px; margin-bottom: 20px; position: relative; transition: 0.3s; }
        .choices { list-style: none; padding: 0; }
        .choices li { background: #fff; border: 1px solid #ddd; padding: 12px; margin: 8px 0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .choices li:hover { background: #e9ecef; border-color: var(--primary-color); }
        .choices li.selected { border-color: var(--primary-color); background: #e7f1ff; font-weight: bold; }
        .voice-btn { position: absolute; top: 15px; left: 15px; background: #fff; border: 1px solid #ddd; width: 35px; height: 35px; border-radius: 50%; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; z-index: 5; }
        .voice-btn:hover { background: var(--primary-color); color: #fff; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .timer-badge { background: #ffeeee; color: var(--danger); padding: 5px 15px; border-radius: 20px; font-weight: bold; border: 1px solid #ffcccc; }
        .smart-timer-container { position: absolute; top: -25px; left: 20px; z-index: 50; }
        .smart-timer { width: 50px; height: 50px; background: white; border: 4px solid #2ecc71; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-family: monospace; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .timer-danger { border-color: #e74c3c; color: #c0392b; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .result-dashboard { text-align: center; padding: 20px 0; display: none; }
        .score-circle-container { position: relative; width: 180px; height: 180px; margin: 0 auto 25px; }
        .score-circle { width: 100%; height: 100%; border-radius: 50%; background: #eee; display: flex; justify-content: center; align-items: center; transition: background 1s ease-out; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .score-inner { width: 85%; height: 85%; background: white; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .score-number { font-size: 3rem; font-weight: 800; color: var(--primary-color); line-height: 1; }
        .grade-message { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; color: #2d3436; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #eee; }
        .stat-val { font-size: 1.2rem; font-weight: bold; display: block; color: #2d3436; }
        .ai-explanation-box { background: #e3f2fd; border-right: 4px solid #2196f3; padding: 15px; margin-top: 15px; border-radius: 6px; display: none; font-size: 0.9em; text-align: right; }
        .confetti { position: fixed; width: 10px; height: 10px; background-color: #f00; animation: fall linear forwards; z-index: 9999; top: -10px; }

        /* --- Smart Overlay Styles --- */
        .smart-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; color: white; font-family: 'Tajawal', sans-serif; overflow: hidden;
        }
        #tamperRoom { background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%); }
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 40px; border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center; max-width: 90%; width: 450px;
            position: relative; z-index: 2;
        }
        .circles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 1; }
        .circles li { position: absolute; display: block; list-style: none; width: 20px; height: 20px; background: rgba(255, 255, 255, 0.2); animation: animate 25s linear infinite; bottom: -150px; border-radius: 50%; }
        .circles li:nth-child(1){ left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .circles li:nth-child(2){ left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .circles li:nth-child(3){ left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        @keyframes animate { 0%{ transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; } 100%{ transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; } }
        .countdown-container { display: flex; justify-content: center; gap: 10px; margin: 25px 0; }
        .time-box { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; min-width: 60px; }
        .time-val { font-size: 2rem; font-weight: 800; display: block; line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .time-lbl { font-size: 0.75rem; opacity: 0.8; text-transform: uppercase; margin-top: 5px; display: block; }
        .status-icon { font-size: 4rem; margin-bottom: 20px; display: inline-block; }
        .waiting-icon { color: #f1c40f; animation: pulseIcon 2s infinite; }
        .expired-icon { color: #e74c3c; }
        @keyframes pulseIcon { 0% { transform: scale(1); opacity: 0.9; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.9; } }
        .jamal-signature { margin-top: 30px; font-family: 'Courier New', monospace; font-size: 0.9rem; letter-spacing: 2px; opacity: 0.6; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; display: inline-block; width: 100%; }
        
 /* ุชูุณููุงุช ุญูู ุงูุงุณู ูุงููุงุฆูุฉ ุงูููุณุฏูุฉ */
.name-box { position: relative; margin-bottom: 25px; }
.name-box label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color); }

.stylish-input {
    width: 100%; padding: 15px 20px; padding-left: 45px;
    border: 2px solid #e1e1e1; border-radius: 12px;
    font-size: 1rem; background: #fdfdfd; transition: all 0.3s;
    font-family: inherit; box-sizing: border-box;
}
.stylish-input:focus { border-color: var(--primary-color); background: #fff; outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

.input-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 1.1rem; pointer-events: none; }

/* ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุงููุฎุตุตุฉ */
.custom-dropdown-list {
    display: none; position: absolute; top: 100%; left: 0; width: 100%;
    max-height: 250px; overflow-y: auto; background: #fff;
    border: 1px solid #ddd; border-radius: 0 0 12px 12px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1); z-index: 1000; margin-top: 5px;
}
.dropdown-item { padding: 12px 15px; border-bottom: 1px solid #f1f1f1; cursor: pointer; transition: 0.2s; font-size: 0.95rem; color: #333; text-align: right; }
.dropdown-item:last-child { border-bottom: none; }
.dropdown-item:hover, .dropdown-item:active { background-color: #f0f7ff; color: var(--primary-color); }
    </style>
</head>
<body>

<ul class="circles"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>

<div class="container">
    <div id="startScreen">
        <h1 style="color:var(--primary-color); margin-bottom:10px;">ุชูุงุฒุน ุงูููุงููู ูู ุงููุงููู ุงูุฏููู ุงูุฎุงุต</h1>
        <p style="color:#666; margin-bottom:20px;">ุงูุชุญุงู ููุงูุฉ ุงููุตู ุงูุฏุฑุงุณู ุงูุซุงูู 2026ู</p>
      
        <div style="background:#f1f3f5; padding:15px; border-radius:8px; margin-bottom:20px;">
            <i class="fa-regular fa-clock"></i> ุงููุฏุฉ: 60 ุฏูููุฉ <br>
            <i class="fa-solid fa-list-ol"></i> ุนุฏุฏ ุงูุฃุณุฆูุฉ: 18
            
            
        </div>
        <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">
        
        
            <div class="name-box">
                <label for="studentName">ุงูุงุณู ุงููุงูู:</label>
                <div style="position: relative;">
                    <input type="text" id="studentName" class="stylish-input" placeholder="ุฃุฏุฎู ุงุณูู ุงูุซูุงุซู">
                    <i class="fa-regular fa-user input-icon"></i>
                </div>
            </div>
        
        
    
        <button id="startBtn" onclick="validateAndStart()" class="btn">ุจุฏุก ุงูุงุฎุชุจุงุฑ ๐</button>
        <div class="footer-copyright" style="margin-top:30px; text-align:center; color:#888; font-size:0.8rem;">Jamal-Alshami ยฉ 2025</div>
    </div>

    <div id="examArea" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <div style="font-weight:bold;"><i class="fa-regular fa-user"></i> <span id="studentNameDisplay"></span></div>
            <div id="timer" class="timer-badge">00:00</div>
        </div>
        <div style="height:8px; background:#eee; border-radius:10px; margin-bottom:25px; overflow:hidden;">
            <div id="progressBar" style="height:100%; width:0%; background:var(--success); transition:0.4s ease-out;"></div>
        </div>
        <div id="questionsContainer"></div>
        <div id="navButtons" style="margin-top:25px; display:flex; gap:10px; justify-content: flex-end;"></div>
    </div>

    <div id="savingScreen" style="display:none; text-align:center; padding:40px;"><h3>ุฌุงุฑู ุญูุธ ุฅุฌุงุจุงุชู...</h3></div>

    <div id="resultScreen" class="result-dashboard">
        <div class="score-circle-container">
            <div id="scoreCircle" class="score-circle">
                <div class="score-inner"><span id="finalScoreNumber" class="score-number">0%</span><span style="font-size: 0.9rem; color: #888;">ุงููุชูุฌุฉ ุงูููุงุฆูุฉ</span></div>
            </div>
        </div>
        <h2 id="resultStudentName" style="color:var(--primary-color);"></h2>
        <div id="gradeMessage" class="grade-message"></div>
        <div class="stats-grid">
            <div class="stat-card"><span style="font-size:1.5rem;">โ๏ธ</span><span id="statCorrect" class="stat-val">0</span><span style="color:#888;">ุตุญูุญุฉ</span></div>
            <div class="stat-card"><span style="font-size:1.5rem;">โ</span><span id="statWrong" class="stat-val">0</span><span style="color:#888;">ุฎุงุทุฆุฉ</span></div>
            <div class="stat-card"><span style="font-size:1.5rem;">โฑ๏ธ</span><span id="statTime" class="stat-val">00:00</span><span style="color:#888;">ุงูููุช</span></div>
        </div>
        <div id="modernActionButtons" style="margin-top:20px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;"></div>
        <div id="certificateArea" style="display:none; border: 10px double var(--primary-color); padding: 30px; margin-top: 30px; background: #fff; position: relative; text-align:center;">
            <h2 style="color:var(--primary-color);">ุดูุงุฏุฉ ุฅุชูุงู</h2>
            <p>ุชุดูุฏ ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑ ุจุฃู ุงูุทุงูุจ/ุฉ:</p>
            <h1 id="certName" style="margin: 15px 0;"></h1>
            <p>ูุฏ ุงุฌุชุงุฒ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ ุจูุชูุฌุฉ:</p>
            <h2 id="certScore" style="color:var(--success);"></h2>
            <p>ุงูุชุงุฑูุฎ: <span id="certDate"></span></p>
        </div>
        <div id="reviewArea" style="text-align:right; margin-top:30px;"></div>
    </div>
</div>

<div id="waitingRoom" class="smart-overlay">
    <div class="glass-panel">
        <i class="fa-solid fa-hourglass-start status-icon waiting-icon"></i>
        <h2 style="margin:0; font-size:1.8rem;">ุงูุงุฎุชุจุงุฑ ูู ูุจุฏุฃ ุจุนุฏ</h2>
        <p style="opacity:0.9; margin-top:10px;">ุงุณุชุนุฏ! ุณูุจุฏุฃ ุงูุงุฎุชุจุงุฑ ุชููุงุฆูุงู ุฎูุงู:</p>
        <div class="countdown-container">
            <div class="time-box"><span class="time-val" id="cd-days">0</span><span class="time-lbl">ููู</span></div>
            <div class="time-box"><span class="time-val" id="cd-hours">00</span><span class="time-lbl">ุณุงุนุฉ</span></div>
            <div class="time-box"><span class="time-val" id="cd-minutes">00</span><span class="time-lbl">ุฏูููุฉ</span></div>
            <div class="time-box"><span class="time-val" id="cd-seconds">00</span><span class="time-lbl">ุซุงููุฉ</span></div>
        </div>
        <div style="font-size:0.9rem; background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; display:inline-block;">
            <i class="fa-regular fa-calendar-check"></i> ููุนุฏ ุงูุจุฏุก: <span id="startDateDisplay" style="font-weight:bold; color:#f1c40f;"></span>
        </div>
        <div class="jamal-signature">Jamal-Alshami</div>
    </div>
</div>

<div id="expiredRoom" class="smart-overlay">
    <div class="glass-panel" style="border-color: rgba(231, 76, 60, 0.3);">
        <i class="fa-solid fa-lock status-icon expired-icon"></i>
        <h2 style="margin:0; font-size:2rem; color:#ffcccc;">ุงูุชูู ููุช ุงูุงุฎุชุจุงุฑ</h2>
        <p style="margin: 15px 0; font-size:1.1rem; line-height:1.6;">
            ูุนุชุฐุฑุ ูู ูุนุฏ ูุฐุง ุงูุงุฎุชุจุงุฑ ูุชุงุญุงู ููุฏุฎูู.<br>
            ููุฏ ุชุฌุงูุฒุช ุงูููุช ุงููุญุฏุฏ ุฃู ุชู ุฅุบูุงู ุงููููุฐุฌ.
        </p>
        <button class="btn" style="background:rgba(255,255,255,0.2); border:1px solid white; width:auto; margin-top:15px;" onclick="window.location.reload()">
            <i class="fa-solid fa-rotate-right"></i> ุชุญุฏูุซ ุงูุตูุญุฉ
        </button>
        <div class="jamal-signature">Jamal-Alshami</div>
    </div>
</div>

<div id="tamperRoom" class="smart-overlay">
    <div class="glass-panel" style="background: rgba(0,0,0,0.4); border-color: red;">
        <i class="fa-solid fa-triangle-exclamation status-icon tamper-icon"></i>
        <h2 style="margin:0; font-size:2rem; color:#fff;">โ๏ธ ุชู ุงูุชุดุงู ุชูุงุนุจ</h2>
        <p style="margin: 15px 0; font-size:1.1rem; line-height:1.6; color:#ffcccc;">
            ููุฏ ููุช ุจุชุบููุฑ ุชุงุฑูุฎ ุฃู ููุช ุงูุฌูุงุฒ ุจุนุฏ ูุชุญ ุงูุงุฎุชุจุงุฑ ูุฃูู ูุฑุฉ.<br>
            ุชู ููู ุงูุงุฎุชุจุงุฑ ููุงุฆูุงู ูุฃุณุจุงุจ ุฃูููุฉ.
        </p>
        <div class="jamal-signature">Jamal-Alshami Security System</div>
    </div>
</div>

<script>
    // ๐ฅ ุงูุจูุงูุงุช ุงููุดูุฑุฉ (ูุง ูููู ูุฑุงุกุชูุง ุฅูุง ุจุงูููุชุงุญ ุงูุตุญูุญ)
    const ENCRYPTED_PAYLOAD = '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';
    // ๐ฅ ุฎุฑูุทุฉ ุงูููุงุชูุญ (ุชุญุชูู ุนูู ุงูููุชุงุญ ุงูุฑุฆูุณู ูุดูุฑุงู ุจุฑูุฒ ูู ุทุงูุจ)
    const SECURITY_VAULT = {};
    const IS_PUBLIC = true;
    const OPEN_KEY = '5ohlibxgdqigl4lwna3mxm'; 
    const GEMINI_KEY = '';
    const SECRET_KEY = 'change-this-to-your-own-secret-phrase-12345';
    
    // ูุชุบูุฑุงุช ุงููุธุงู
    let fullExamData = null;
    let CONFIG = {};
    let currentQuestions = [];
    let studentAnswers = {};
    let currentIndex = 0;
    let studentName = "";
    let timerInterval;
    let questionInterval;
    let examStartTime = null;
    let isRetryMode = false;
    let tabSwitchCount = 0;
    let examFinished = false;
    let warningCount = 0;
    let fbApp = null, fbDb = null, studentRef = null;
    let lastAlertTime = 0;

    // ุชุนุฑูู ุงููุงูู ูุงููุณุชูุฏุน ููุง ูููุณุฎุฉ ุงูููุดูุฑุฉ
    const GITHUB_OWNER = 'alshami2024';
    const GITHUB_REPO = 'alshami';

    // --- 1. ุฏุงูุฉ ูู ุงูุชุดููุฑ ุงูุฑุฆูุณูุฉ (Access Code Logic) ---
    function decryptExamData(userCode, userName) {
        try {
            let masterKey = "";
            if (IS_PUBLIC) {
                masterKey = OPEN_KEY;
            } else {
                const encryptedMasterKey = SECURITY_VAULT[userName.trim()];
                if (!encryptedMasterKey) throw new Error("ุงูุงุณู ุบูุฑ ููุฌูุฏ ูู ุงููุงุฆูุฉ ุงููุณููุญ ููุง.");
                
                // ูุญุงููุฉ ูู ููู ุงูููุชุงุญ ุงูุฑุฆูุณู ุจุงุณุชุฎุฏุงู ุฑูุฒ ุงูุทุงูุจ
                // ุฅุฐุง ูุงู ุงูุฑูุฒ ุฎุทุฃุ ุณุชูุดู ุนูููุฉ ูู ุงูุชุดููุฑ ุฃู ุชูุชุฌ ููุชุงุญุงู ุนุดูุงุฆูุงู
                const bytes = CryptoJS.AES.decrypt(encryptedMasterKey, userCode.trim());
                masterKey = bytes.toString(CryptoJS.enc.Utf8);
                
                if (!masterKey) throw new Error("ุฑูุฒ ุงูุฏุฎูู ุบูุฑ ุตุญูุญ!");
            }

            // ูู ุชุดููุฑ ุงูุงุฎุชุจุงุฑ ุจุงูููุชุงุญ ุงูุฑุฆูุณู
            const payloadBytes = CryptoJS.AES.decrypt(ENCRYPTED_PAYLOAD, masterKey);
            const decryptedString = payloadBytes.toString(CryptoJS.enc.Utf8);
            
            if (!decryptedString) throw new Error("ูุดู ูู ุงูุชุดููุฑ. ุงูุจูุงูุงุช ุชุงููุฉ ุฃู ุงูุฑูุฒ ุฎุงุทุฆ.");
            
            fullExamData = JSON.parse(decryptedString);
            
            // ูู ุชุดููุฑ ุงูููุงุชูุญ ุงูุญุณุงุณุฉ ุฅุฐุง ูุฌุฏุช
            if (fullExamData.config.botToken) {
                 try {
                     fullExamData.config.botToken = CryptoJS.AES.decrypt(fullExamData.config.botToken, SECRET_KEY).toString(CryptoJS.enc.Utf8);
                     fullExamData.config.chatId = CryptoJS.AES.decrypt(fullExamData.config.chatId, SECRET_KEY).toString(CryptoJS.enc.Utf8);
                     fullExamData.config.githubToken = CryptoJS.AES.decrypt(fullExamData.config.githubToken, SECRET_KEY).toString(CryptoJS.enc.Utf8);
                 } catch(e) {}
            }

            // ุฅุนุฏุงุฏ ุงูุชูููู ุงูุนุงู
            CONFIG = { 
                layout: fullExamData.config.layout || 'one-by-one',
                retry: fullExamData.config.enableSmartRetry,
                qTimer: fullExamData.config.perQuestionTimer, 
                qSeconds: fullExamData.config.perQuestionSeconds,
                tts: fullExamData.config.enableTextToSpeech,
                ai: fullExamData.config.enableAITutor
            };

            return true;
        } catch (e) {
            console.error(e);
            alert("โ ุฎุทุฃ: " + e.message);
            return false;
        }
    }

    function verifyTimeIntegrity() {
        if(!fullExamData) return true; // Safety check
        const storageKey = 'EXAM_LOCK_' + btoa(encodeURIComponent(fullExamData.config.title));
        const currentTime = new Date().getTime();
        const storedTime = localStorage.getItem(storageKey);

        if (!storedTime) {
            localStorage.setItem(storageKey, currentTime.toString());
            return true; 
        } else {
            const firstOpenTime = parseInt(storedTime);
            if (currentTime < (firstOpenTime - 60000)) {
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('tamperRoom').style.display = 'flex';
                return false; 
            }
            return true; 
        }
    }

    function checkTimeConstraints() {
        if(!fullExamData) return true; // Wait for decryption
        if (!verifyTimeIntegrity()) return false;
        if (!fullExamData.config.startTime && !fullExamData.config.endTime) return true;

        const now = new Date();
        const start = fullExamData.config.startTime ? new Date(fullExamData.config.startTime) : null;
        const end = fullExamData.config.endTime ? new Date(fullExamData.config.endTime) : null;

        if (start && now < start) {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('examArea').style.display = 'none';
            document.getElementById('waitingRoom').style.display = 'flex';
            const dateStr = start.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = start.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('startDateDisplay').innerHTML = dateStr + ' | ุงูุณุงุนุฉ: ' + timeStr;
            startCountdown(start);
            return false;
        }

        if (end && now > end) {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('examArea').style.display = 'none';
            document.getElementById('waitingRoom').style.display = 'none';
            document.getElementById('expiredRoom').style.display = 'flex';
            return false;
        }
        
        document.getElementById('waitingRoom').style.display = 'none';
        document.getElementById('expiredRoom').style.display = 'none';
        return true;
    }

    function startCountdown(targetDate) {
        const interval = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate.getTime() - now;
            if (distance < 0) {
                clearInterval(interval);
                document.getElementById('waitingRoom').innerHTML = '<div class="glass-panel"><h2>ุฌุงุฑู ุงูุฏุฎูู ููุงุฎุชุจุงุฑ...</h2></div>';
                setTimeout(() => window.location.reload(), 1500);
                return;
            }
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('cd-days').innerText = days;
            document.getElementById('cd-hours').innerText = hours.toString().padStart(2, '0');
            document.getElementById('cd-minutes').innerText = minutes.toString().padStart(2, '0');
            document.getElementById('cd-seconds').innerText = seconds.toString().padStart(2, '0');
        }, 1000);
    }

    function saveExamProgress() {
        if (!studentName || !fullExamData) return;
        const uniqueId = 'exam_' + fullExamData.config.title + '_' + studentName;
        const state = {
            status: 'active', 
            answers: studentAnswers,
            startTime: examStartTime.getTime(), 
            timestamp: new Date().getTime(),
            qOrder: currentQuestions,
            currentIndex: currentIndex
        };
        localStorage.setItem(uniqueId, JSON.stringify(state));
    }

    // -------------------------------------------------------------
    // โ ุฏุงูุฉ ุงูุชุญูู ุงููุนุฏูุฉ (ุฏูุฌ ุงูุชุดููุฑ ุงูุฌุฏูุฏ ูุน ุงูููุทู ุงููุฏูู)
    // -------------------------------------------------------------
    window.validateAndStart = function() {
        var nameInput = document.getElementById('studentName');
        if (!nameInput) return;
        var val = nameInput.value.trim();
        if (!val) { alert("ุฃุฏุฎู ุงุณูู"); return; }

        // 1. ูุญุงููุฉ ูู ุงูุชุดููุฑ ุฃููุงู (ููุญุตูู ุนูู fullExamData)
        let code = "";
        if (!IS_PUBLIC) {
            const codeInput = document.getElementById('accessCode');
            code = codeInput ? codeInput.value.trim() : '';
            if (!code) { alert("ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู ููู ุงูุชุดููุฑ."); return; }
        }

        const success = decryptExamData(code, val);
        if (!success) return; 

        // 2. ุงูุชุญูู ูู ุงูููุช ุจุนุฏ ูู ุงูุชุดููุฑ
        if (!checkTimeConstraints()) return;

        studentName = val;

        // ุฅุนุฏุงุฏ ุงูุฌูุณุฉ (ููุณ ุงูููุฏ ุงูุฃุตูู)
        var uniqueId = 'exam_' + fullExamData.config.title + '_' + studentName;
        var savedStateStr = localStorage.getItem(uniqueId);
        var isResuming = false;

        if (fullExamData.config.singleUseMode && savedStateStr) {
            if (savedStateStr === 'done') {
                alert("ููุฏ ุฃุฏูุช ูุฐุง ุงูุงุฎุชุจุงุฑ ูุณุจูุงู ููุง ูุณูุญ ุจุงูุชูุฑุงุฑ.");
                return;
            }
            try {
                var savedState = JSON.parse(savedStateStr);
                if (savedState && savedState.answers) {
                    studentAnswers = savedState.answers || {};
                    examStartTime = new Date(savedState.startTime);
                    if(savedState.qOrder) currentQuestions = savedState.qOrder;
                    if(savedState.currentIndex) currentIndex = savedState.currentIndex;
                    isResuming = true;
                    
                    if (fullExamData.config.time > 0) {
                        var now = new Date();
                        var elapsedSeconds = Math.floor((now - examStartTime) / 1000);
                        var totalExamSeconds = fullExamData.config.time * 60;
                        if (elapsedSeconds >= totalExamSeconds) {
                            alert("ุงูุชูู ููุช ุงูุงุฎุชุจุงุฑ ุงูุฃุตูู!");
                            finishExam(true);
                            return;
                        }
                    }
                    alert("ุชู ุงุณุชุนุงุฏุฉ ุฌูุณุชู ุงูุณุงุจูุฉ.");
                }
            } catch (e) { }
        }

        if (!isResuming) {
            var pool = JSON.parse(JSON.stringify(fullExamData.questions));
            if (fullExamData.config.shuffle) pool.sort(function() { return 0.5 - Math.random() });
            
            if (fullExamData.config.questionBankMode && fullExamData.config.questionsToShow > 0) {
                currentQuestions = pool.slice(0, Math.min(fullExamData.config.questionsToShow, pool.length));
            } else {
                currentQuestions = pool;
            }

            if (fullExamData.config.shuffleChoices) {
                currentQuestions.forEach(function(q) {
                    if (q.type === 'mcq' && q.choices) {
                        var indices = q.choices.map(function(_, i) { return i; });
                        indices.sort(function() { return 0.5 - Math.random() });
                        q.shuffledIndices = indices;
                    }
                });
            }
            examStartTime = new Date();
        } else {
             if(!currentQuestions || currentQuestions.length === 0) {
                 currentQuestions = JSON.parse(JSON.stringify(fullExamData.questions));
             }
        }

        saveExamProgress();

        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('examArea').style.display = 'block';
        document.getElementById('studentNameDisplay').innerText = studentName;
        
        if(typeof initStudentFirebase === 'function') initStudentFirebase(); 
        if(typeof updateLiveStatus === 'function') updateLiveStatus();

        if (!isResuming && typeof sendTelegramNotification === 'function') {
            sendTelegramNotification("๐ *ุจุฏุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ*\n๐ค ุงูุทุงูุจ: " + studentName + "\n๐ ุงูุงุฎุชุจุงุฑ: " + fullExamData.config.title);
        }
        
        if(fullExamData.config.time > 0) {
            var now = new Date();
            var secondsPassed = Math.floor((now - examStartTime) / 1000);
            var secondsLeft = (fullExamData.config.time * 60) - secondsPassed;
            startTimer(secondsLeft); 
        } else {
            var timerEl = document.getElementById('timer');
            if(timerEl) timerEl.style.display = 'none';
        }
        
        setupSecurity();
        renderExam();
        try { requestFullScreenMode(); } catch(e){}
    };

    function requestFullScreenMode() {
        const docElm = document.documentElement;
        if (docElm.requestFullscreen) { docElm.requestFullscreen().catch(err => {}); } 
        else if (docElm.webkitRequestFullScreen) { docElm.webkitRequestFullScreen().catch(err => {}); }
    }

    function renderExam() {
        const container = document.getElementById('questionsContainer');
        container.innerHTML = '';
        if (CONFIG.layout === 'one-by-one') {
            renderSingleQuestion(currentIndex, container);
        } else {
            currentQuestions.forEach((q, idx) => renderSingleQuestion(idx, container));
        }
        updateNav();
        updateProgress();
    }

    function renderSingleQuestion(idx, container) {
        const q = currentQuestions[idx];
        const voiceBtn = CONFIG.tts ? `<button class="voice-btn" onclick="speak('${q.text.replace(/[\r\n]/g, ' ').replace(/'/g, "\\'")}')"><i class="fa-solid fa-volume-high"></i></button>` : '';
        
        let timerHtml = '';
        if (CONFIG.qTimer && CONFIG.layout === 'one-by-one') {
            timerHtml = `<div class="smart-timer-container"><div id="qTimerRing" class="smart-timer">${CONFIG.qSeconds}</div></div>`;
        }

        let html = `<div class="question-card">${timerHtml} ${voiceBtn} <h3>${idx + 1}. ${q.text}</h3>`;
        if (q.image) html += `<img src="${q.image}" style="max-width:100%; border-radius:8px;">`;

        if (q.type === 'mcq' || q.type === 'tf') {
            const opts = q.type === 'tf' ? ['ุตุญ', 'ุฎุทุฃ'] : q.choices;
            let displayOrder = [];
            if (q.type === 'mcq' && q.shuffledIndices) {
                displayOrder = q.shuffledIndices;
            } else {
                displayOrder = opts.map((_, i) => i);
            }

            html += '<ul class="choices">';
            displayOrder.forEach((originalIndex) => {
                const optText = opts[originalIndex];
                const isSel = studentAnswers[idx] === originalIndex ? 'selected' : '';
                html += `<li class="${isSel}" onclick="selectOption(${idx}, ${originalIndex}, this)">${optText}</li>`;
            });
            html += '</ul>';
        } else {
             html += `<textarea style="width:100%;" rows="4" oninput="studentAnswers[${idx}]=this.value; saveExamProgress()">${studentAnswers[idx]||''}</textarea>`;
        }
        html += '</div>';
        container.insertAdjacentHTML('beforeend', html);

        if (CONFIG.qTimer && CONFIG.layout === 'one-by-one') {
            setTimeout(function() { startQuestionTimer(); }, 50);
        }
    }

    function startQuestionTimer() {
        clearInterval(questionInterval);
        let left = CONFIG.qSeconds;
        const el = document.getElementById('qTimerRing');
        if(!el) return;
        el.innerText = left;
        el.className = "smart-timer";
        questionInterval = setInterval(() => {
            left--;
            if(el) {
                el.innerText = left;
                if (left <= 5) el.classList.add('timer-danger');
            }
            if (left <= 0) {
                clearInterval(questionInterval);
                if (currentIndex < currentQuestions.length - 1) { 
                    currentIndex++; 
                    saveExamProgress(); 
                    renderExam(); 
                }
                else { finishExam(); }
            }
        }, 1000);
    }

    window.selectOption = function(qIdx, optIdx, el) {
        studentAnswers[qIdx] = optIdx;
        saveExamProgress();
        updateLiveStatus();
        if(CONFIG.layout === 'one-by-one') {
            el.parentElement.querySelectorAll('li').forEach(l => l.classList.remove('selected'));
            el.classList.add('selected');
        } else {
            el.parentElement.querySelectorAll('li').forEach(l => l.classList.remove('selected'));
            el.classList.add('selected');
        }
        updateProgress();
        if (qIdx === currentQuestions.length - 1) sendSilentReport();
    };

    async function sendSilentReport() {
        const endTime = new Date();
        const diff = Math.floor((endTime - examStartTime) / 1000);
        const timeFormatted = `${Math.floor(diff/60)}:${(diff%60).toString().padStart(2,'0')}`;
        let correct = 0;
        let totalAuto = 0;
        currentQuestions.forEach((q, i) => {
            const ans = studentAnswers[i];
            const qType = (q.type || 'mcq').toLowerCase();
            if (qType === 'mcq' || qType === 'tf') {
                totalAuto++;
                if (ans !== undefined && parseInt(ans) === parseInt(q.correctAnswer)) correct++;
            }
        });
        const score = totalAuto > 0 ? Math.round((correct / totalAuto) * 100) : 0;
        const telegramMsg = `๐ต๏ธ *ุฅุดุนุงุฑ ูุฑุงูุจุฉ (ูุณูุฏุฉ)*\n(ุฃุฌุงุจ ุงูุทุงูุจ ุนูู ุงูุณุคุงู ุงูุฃุฎูุฑ ูููู ูู ูุถุบุท ุชุณููู)\n๐ค ุงูุทุงูุจ: ${studentName}\n๐ ุงูุงุฎุชุจุงุฑ: ${fullExamData.config.title}\n๐ฏ ุงูุฏุฑุฌุฉ ุงูุญุงููุฉ: ${correct}/${totalAuto} (${score}%)\nโฑ๏ธ ุงูููุช ุงููููุถู: ${timeFormatted}`;
        await sendTelegramNotification(telegramMsg);
    }

    window.nextQuestion = function() {
        if (studentAnswers[currentIndex] === undefined || studentAnswers[currentIndex] === null || studentAnswers[currentIndex] === "") {
            alert("โ๏ธ ูุฌุจ ุงูุฅุฌุงุจุฉ ุนูู ุงูุณุคุงู ุงูุญุงูู ุฃููุงู.");
            return;
        }
        currentIndex++;
        saveExamProgress(); 
        updateLiveStatus();
        renderExam();
    };

    window.prevQuestion = function() {
        if (!fullExamData.config.noGoingBack) {
            currentIndex--;
            saveExamProgress();
            renderExam();
        }
    };

    function updateNav() {
        const nav = document.getElementById('navButtons');
        nav.innerHTML = '';
        if (CONFIG.layout === 'one-by-one') {
            if (currentIndex > 0 && !fullExamData.config.noGoingBack) {
                nav.innerHTML += `<button class="btn" style="width:auto; background:#777;" onclick="prevQuestion()">ุงูุณุงุจู</button>`;
            }
            if (currentIndex < currentQuestions.length - 1) {
                nav.innerHTML += `<button class="btn" style="width:auto;" onclick="nextQuestion()">ุงูุชุงูู</button>`;
            } else {
                nav.innerHTML += `<button class="btn btn-danger" style="width:auto;" onclick="finishExam()">ุฅููุงุก</button>`;
            }
        } else {
            nav.innerHTML = `<button class="btn btn-danger" onclick="finishExam()">ุชุณููู</button>`;
        }
    }

    function updateProgress() {
        document.getElementById('progressBar').style.width = ((Object.keys(studentAnswers).length / currentQuestions.length) * 100) + '%';
    }

    window.finishExam = async function(force = false) {
        if (!force && CONFIG.layout === 'one-by-one') {
             if (studentAnswers[currentIndex] === undefined || studentAnswers[currentIndex] === null || studentAnswers[currentIndex] === "") {
                if(!confirm("โ๏ธ ูู ุชุฌุจ ุนูู ุงูุณุคุงู ุงูุญุงูู. ูู ุชุฑูุฏ ุงูุชุณูููุ")) return;
            }
        }
        if(!force && !confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุชุณููู ุงูููุงุฆูุ")) return;
        
        clearInterval(timerInterval);
        clearInterval(questionInterval);
        document.getElementById('examArea').style.display = 'none';
        document.getElementById('savingScreen').style.display = 'block';

        const endTime = new Date();
        const diff = Math.floor((endTime - examStartTime) / 1000);
        const timeFormatted = `${Math.floor(diff/60)}:${(diff%60).toString().padStart(2,'0')}`;

        let correct = 0;
        let totalAuto = 0;
        let wrongIndices = [];
        let detailedAnswers = [];
        let essayTotalMax = 0;

        currentQuestions.forEach((q, i) => {
            const ans = studentAnswers[i];
            const qType = (q.type || 'mcq').toLowerCase();
            let ansObj = { question: q.text, type: qType, isCorrect: false, isGraded: true, maxScore: 1, answer: "ูู ุชุชู ุงูุฅุฌุงุจุฉ" };

            if (qType === 'mcq' || qType === 'tf') {
                totalAuto++;
                let opts = qType === 'tf' ? ['ุตุญ', 'ุฎุทุฃ'] : q.choices;
                if(ans !== undefined && ans !== null) ansObj.answer = opts[ans] || ans;
                if (ans !== undefined && parseInt(ans) === parseInt(q.correctAnswer)) {
                    correct++;
                    ansObj.isCorrect = true;
                } else {
                    wrongIndices.push(i);
                    ansObj.correctAnswer = opts[q.correctAnswer];
                }
            } else {
                ansObj.answer = ans || "ูุง ุฅุฌุงุจุฉ";
                ansObj.isGraded = false;
                ansObj.maxScore = q.maxScore || 10;
                essayTotalMax += ansObj.maxScore;
            }
            detailedAnswers.push(ansObj);
        });

        const score = totalAuto > 0 ? Math.round((correct / totalAuto) * 100) : 0;
        const passed = score >= (fullExamData.config.successPercentage || 50);
        
        let uploadSuccess = false;
        try {
            const deviceId = getUniqueDeviceId();
            const telegramMsg = `๐ *ุชุณููู ููุงุฆู*\n๐ค ุงูุทุงูุจ: ${studentName}\n๐ฑ ุงูุฌูุงุฒ: ` + deviceId + `\n๐ฏ ุงูุฏุฑุฌุฉ: ${correct}/${totalAuto} (${score}%)`;
            await sendTelegramNotification(telegramMsg);
            
            if(fullExamData.config.githubToken && fullExamData.config.resultsFilename) {
                await saveToGithub(correct, totalAuto, wrongIndices, detailedAnswers, essayTotalMax);
                uploadSuccess = true;
            } else {
                uploadSuccess = true; 
            }
        } catch (e) {
            console.error("Upload failed", e);
            alert("โ๏ธ ุถุนู ูู ุงูุฅูุชุฑูุช! ูู ูุชู ุญูุธ ุงููุชูุฌุฉ ุนูู ุงูุณูุฑูุฑ.");
        }

        if(fullExamData.config.singleUseMode) {
            const uniqueId = 'exam_' + fullExamData.config.title + '_' + studentName;
            if (uploadSuccess) {
                localStorage.setItem(uniqueId, 'done');
                examFinished = true;
                displayResultsScreen(passed, score, correct, totalAuto, timeFormatted, wrongIndices);
            } else {
                document.getElementById('savingScreen').style.display = 'none';
                if (force) alert("โ๏ธ ุชุนุฐุฑ ุชุณููู ุงููุชูุฌุฉ.");
                else {
                    document.getElementById('examArea').style.display = 'block';
                    alert("ูุดู ุงูุงุชุตุงู! ุญุงูู ูุฑุฉ ุฃุฎุฑู.");
                }
                return;
            }
        } else {
             examFinished = true;
             displayResultsScreen(passed, score, correct, totalAuto, timeFormatted, wrongIndices);
        }
    };

    function displayResultsScreen(passed, score, correct, totalAuto, timeFormatted, wrongIndices) {
        document.getElementById('savingScreen').style.display = 'none';
        document.getElementById('resultScreen').style.display = 'block';
        document.getElementById('resultStudentName').innerText = studentName;

        if (!fullExamData.config.showResults) {
            document.querySelector('.score-circle-container').style.display = 'none';
            document.querySelector('.stats-grid').style.display = 'none';
            document.getElementById('gradeMessage').innerText = "ุชู ุงุณุชูุงู ุฅุฌุงุจุชู ุจูุฌุงุญ. ุจุงูุชูููู! ๐น";
            document.getElementById('gradeMessage').style.color = "var(--primary-color)";
            document.getElementById('modernActionButtons').innerHTML = ''; 
            return; 
        }

        document.getElementById('statCorrect').innerText = correct;
        document.getElementById('statWrong').innerText = totalAuto - correct;
        document.getElementById('statTime').innerText = timeFormatted;
        
        const circle = document.getElementById('scoreCircle');
        const numberEl = document.getElementById('finalScoreNumber');
        const color = passed ? '#2ecc71' : '#e74c3c';
        let currentPct = 0;
        numberEl.innerText = "0%";
        circle.style.background = `conic-gradient(${color} 0deg, #eee 0deg)`;

        const animTimer = setInterval(() => {
            if(score === 0) { clearInterval(animTimer); return; }
            currentPct++;
            numberEl.innerText = currentPct + "%";
            numberEl.style.color = color;
            circle.style.background = `conic-gradient(${color} ${currentPct * 3.6}deg, #eee ${currentPct * 3.6}deg)`;
            if (currentPct >= score) clearInterval(animTimer);
        }, 20);
        
        const msgEl = document.getElementById('gradeMessage');
        if (score >= 90) { msgEl.innerText = "ุฃุฏุงุก ุฃุณุทูุฑู! ๐"; msgEl.style.color = "#f1c40f"; startConfetti(); }
        else if (passed) { msgEl.innerText = "ูุงุฌุญ ๐"; msgEl.style.color = "#3498db"; }
        else { msgEl.innerText = "ุญุธุงู ุฃููุฑ ๐"; msgEl.style.color = "#e74c3c"; }
        
        const btns = document.getElementById('modernActionButtons');
        btns.innerHTML = '';
        if(passed && fullExamData.config.enableCertificate) {
            btns.innerHTML += `<button class="btn btn-success" style="width:auto;" onclick="showCertificate()">๐ ุงูุดูุงุฏุฉ</button>`;
            document.getElementById('certName').textContent = studentName;
            document.getElementById('certScore').textContent = score + "%";
            document.getElementById('certDate').textContent = new Date().toLocaleDateString('ar-EG');
        }
        if(fullExamData.config.enableReview) {
            btns.innerHTML += `<button class="btn" style="width:auto;" onclick="renderReview(${JSON.stringify(wrongIndices)})">๐๏ธ ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก</button>`;
        }
    }

    window.renderReview = function(indices) {
        const div = document.getElementById('reviewArea');
        div.innerHTML = '<h3>ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก:</h3>';
        indices.forEach(i => {
            const q = currentQuestions[i];
            const opts = q.type === 'tf' ? ['ุตุญ', 'ุฎุทุฃ'] : q.choices;
            let aiBtn = '';
            if(CONFIG.ai && GEMINI_KEY && (q.type==='mcq'||q.type==='tf')) {
                aiBtn = `<button class="btn" style="font-size:0.8rem; background:#673ab7; margin-top:10px;" onclick="askAI(this, ${i})"><i class="fa-solid fa-robot"></i> ููุงุฐุง ุฅุฌุงุจุชู ุฎุงุทุฆุฉุ</button><div id="ai-res-${i}" class="ai-explanation-box"></div>`;
            }
            div.innerHTML += `<div class="question-card" style="border-right:4px solid red; text-align:right;">
                <p><strong>${q.text}</strong></p>
                <p style="color:red;">ุฅุฌุงุจุชู ุฎุงุทุฆุฉ โ</p>
                <p style="color:green;">ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ${opts[q.correctAnswer]}</p>
                ${aiBtn}
            </div>`;
        });
        div.scrollIntoView({behavior:'smooth'});
    };

    window.askAI = async function(btn, idx) {
        const q = currentQuestions[idx];
        const opts = q.type === 'tf' ? ['ุตุญ', 'ุฎุทุฃ'] : q.choices;
        const userTxt = opts[studentAnswers[idx]] || "ูุง ููุฌุฏ";
        const corrTxt = opts[q.correctAnswer];
        const resBox = document.getElementById(`ai-res-${idx}`);
        
        const encryptedKey = ''; 
        const passPhrase = 'Exam-Secret-Pass-2025'; 
        resBox.style.display = 'block';
        resBox.innerHTML = 'ุฌุงุฑู ุชุญููู ุงูุฅุฌุงุจุฉ...';
        btn.disabled = true;

        let realApiKey = '';
        try {
            if(!encryptedKey) throw new Error("ุงูููุชุงุญ ุบูุฑ ููุฌูุฏ");
            const bytes = CryptoJS.AES.decrypt(encryptedKey, passPhrase);
            realApiKey = bytes.toString(CryptoJS.enc.Utf8);
        } catch (e) {
            resBox.innerHTML = 'ุฎุทุฃ: ููุชุงุญ ุงูุฃูุงู ููููุฏ.';
            btn.disabled = false;
            return;
        }

        const prompt = `The student answered incorrectly. Explain simply why the answer is wrong in Arabic.
        Question: ${q.text}
        Student Answer: ${userTxt}
        Correct Answer: ${corrTxt}`;

        try {
            const response = await fetch('https://api.chatanywhere.tech/v1/chat/completions', {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${realApiKey}`
                },
                body: JSON.stringify({ 
                    model: "gpt-4o-mini",
                    messages: [{ role: "user", content: prompt }] 
                })
            });
            if (!response.ok) throw new Error("API Error");
            const data = await response.json();
            const reply = data.choices[0].message.content;
            resBox.innerHTML = `<strong>๐ค ุงููุนูู ุงูุฐูู:</strong><br>${reply}`;
        } catch(e) { resBox.innerHTML = 'ูุดู ุงูุงุชุตุงู.'; } finally {
            btn.disabled = false;
            realApiKey = null;
        }
    };

    window.showCertificate = function() {
        document.getElementById('certificateArea').style.display = 'block';
        document.getElementById('certificateArea').scrollIntoView({behavior:'smooth'});
        startConfetti();
    };
    
    window.startSmartRetry = function(indices) {
        const wrongQs = indices.map(i => currentQuestions[i]);
        currentQuestions = wrongQs;
        studentAnswers = {};
        currentIndex = 0;
        isRetryMode = true;
        document.getElementById('resultScreen').style.display = 'none';
        document.getElementById('examArea').style.display = 'block';
        renderExam();
    };

    function startConfetti() {
        for (let i = 0; i < 100; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + 'vw';
            c.style.backgroundColor = ['#e74c3c','#3498db','#f1c40f'][Math.floor(Math.random()*3)];
            c.style.animationDuration = (Math.random() * 2 + 3) + 's';
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 5000);
        }
    }

    function initStudentFirebase() {
        if (fullExamData.config.firebase && fullExamData.config.firebase.apiKey) {
            try {
                var dbUrl = fullExamData.config.firebase.dbUrl.trim();
                if (!dbUrl.startsWith("https://")) dbUrl = "https://" + dbUrl;
                if (dbUrl.endsWith("/")) dbUrl = dbUrl.slice(0, -1);
                var config = {
                    apiKey: fullExamData.config.firebase.apiKey,
                    databaseURL: dbUrl,
                    projectId: fullExamData.config.firebase.projectId
                };
                if (!firebase.apps.length) fbApp = firebase.initializeApp(config, "studentApp");
                else fbApp = firebase.app("studentApp"); 
                fbDb = fbApp.database();
                var safeTitle = fullExamData.config.title.replace(/[^a-z0-9_ุ-ฟ]/ig, '_');
                if(studentName) {
                    studentRef = fbDb.ref('exams/' + safeTitle + '/students/' + studentName);
                    studentRef.onDisconnect().update({ status: 'offline' });
                    studentRef.update({ status: 'active', lastActive: firebase.database.ServerValue.TIMESTAMP, name: studentName, command: 'none' });
                    studentRef.on('value', function(snapshot) {
                        var data = snapshot.val();
                        if (!data) {
                            document.body.innerHTML = '<h1 style="text-align:center; color:red; margin-top:50px;">โ ุชู ุฅุฎุฑุงุฌู ูู ุงูุงุฎุชุจุงุฑ.</h1>';
                            setTimeout(function() { window.location.reload(); }, 3000);
                            return;
                        }
                        if (data.command === 'TERMINATE' || data.status === 'terminated') {
                            if (!examFinished) {
                                alert("โ๏ธ ุชู ุณุญุจ ูุฑูุฉ ุงูุงุฎุชุจุงุฑ ุงูุฎุงุตุฉ ุจู!");
                                finishExam(true);
                            }
                        }
                        if (data.alertMessage && data.alertTime && data.alertTime > lastAlertTime) {
                            lastAlertTime = data.alertTime;
                            alert("๐จ ุฑุณุงูุฉ ูู ุงููุฑุงูุจ: " + data.alertMessage);
                        }
                    });
                }
            } catch (e) { console.error("Firebase init error: " + e.message); }
        }
    }

    function updateLiveStatus(status = 'active') {
        if (!studentRef) return;
        let currentScore = 0;
        let answered = 0;
        currentQuestions.forEach((q, i) => {
            if (studentAnswers[i] !== undefined) {
                answered++;
                if ((q.type === 'mcq' || q.type === 'tf') && parseInt(studentAnswers[i]) === parseInt(q.correctAnswer)) currentScore++;
            }
        });
        studentRef.update({
            name: studentName, status: status, currentQuestion: currentIndex, totalQuestions: currentQuestions.length,
            answeredCount: answered, score: currentScore, tabSwitchCount: tabSwitchCount, lastActive: firebase.database.ServerValue.TIMESTAMP
        });
    }

    function getUniqueDeviceId() {
        let deviceId = localStorage.getItem('exam_device_fingerprint');
        if (!deviceId) {
            deviceId = 'DEV-' + Math.random().toString(36).substr(2, 9).toUpperCase() + '-' + Date.now().toString(36);
            localStorage.setItem('exam_device_fingerprint', deviceId);
        }
        return deviceId;
    }

    async function saveToGithub(correct, total, wrongIndices, detailedAnswers, essayTotalMax) {
        var conf = fullExamData.config;
        var token = conf.githubToken;
        var filename = conf.resultsFilename;
        var title = conf.title;
        if(!token || !filename) return;
        if (filename.indexOf('exam/') === 0) filename = filename.substring(5);
        if (filename.indexOf('.json') !== -1) filename = filename.replace('.json', '');
        var owner = (typeof GITHUB_OWNER !== 'undefined') ? GITHUB_OWNER : 'alshami2024';
        var repo = (typeof GITHUB_REPO !== 'undefined') ? GITHUB_REPO : 'alshami';
        var url = "https://api.github.com/repos/" + owner + "/" + repo + "/contents/exam/" + filename + ".json";
        var resultPayload = {
            examTitle: title || "ุงุฎุชุจุงุฑ ุจุฏูู ุนููุงู", studentName: studentName, deviceId: getUniqueDeviceId(),
            submissionDate: new Date().toISOString(), mcqScore: { correct: correct, total: total },
            essayScore: { totalScore: 0, totalMax: essayTotalMax }, answers: detailedAnswers, tabSwitchCount: tabSwitchCount
        };
        try {
            var currentData = [];
            var sha = null;
            try {
                var getRes = await fetch(url + "?t=" + Date.now(), { headers: { 'Authorization': 'token ' + token } });
                if(getRes.ok) {
                    var json = await getRes.json();
                    sha = json.sha;
                    currentData = JSON.parse(decodeURIComponent(escape(atob(json.content))));
                }
            } catch(e) {}
            currentData.push(resultPayload);
            var contentEncoded = btoa(unescape(encodeURIComponent(JSON.stringify(currentData, null, 2))));
            await fetch(url, {
                method: 'PUT', headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: 'New Result: ' + studentName, content: contentEncoded, sha: sha })
            });
            localStorage.setItem('exam_' + title + '_' + studentName, 'done');
        } catch(e) { console.error("Github Save Failed", e); }
    }

    async function sendTelegramNotification(text) { 
        try { await fetch(`https://api.telegram.org/bot${fullExamData.config.botToken}/sendMessage`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ chat_id: fullExamData.config.chatId, text: text, parse_mode: 'Markdown' }) }); } catch(e){} 
    }

    function startTimer(initialSecondsLeft) {
        const totalDurationSeconds = fullExamData.config.time * 60;
        timerInterval = setInterval(() => {
            const now = new Date();
            const secondsElapsed = Math.floor((now - examStartTime) / 1000);
            const secondsLeft = totalDurationSeconds - secondsElapsed;
            if(secondsLeft <= 0) { 
                clearInterval(timerInterval); 
                finishExam(true);
            } else {
                document.getElementById('timer').innerText = `${Math.floor(secondsLeft/60)}:${(secondsLeft%60).toString().padStart(2,'0')}`;
            }
        }, 1000);
    }

    function setupSecurity() {
        const MAX_WARNINGS = 3;
        if(fullExamData.config.disableCheating) {
            ['contextmenu', 'copy', 'paste', 'cut', 'dragstart', 'selectstart'].forEach(event => {
                document.addEventListener(event, e => { e.preventDefault(); return false; });
            });
        }
        if(fullExamData.config.monitorTabs) {
            const handleViolation = () => {
                if(examFinished) return;
                if (!fullExamData.config.finishOnSwitch) { tabSwitchCount++; return; }
                warningCount++; tabSwitchCount++;
                document.body.style.filter = "blur(10px)";
                document.title = "โ๏ธ ุชุญุฐูุฑ: ุนุฏ ููุฑุงู!";
                if (warningCount > MAX_WARNINGS) {
                    finishExam(true); 
                    alert("โ ุชู ุฅููุงุก ุงุฎุชุจุงุฑู ุขููุงู ุจุณุจุจ ุชูุฑุงุฑ ุงูุฎุฑูุฌ.");
                } else {
                    alert("โ๏ธ ุชุญุฐูุฑ ุฃููู (" + warningCount + "/" + MAX_WARNINGS + ")\nูููุน ุงูุฎุฑูุฌ ูู ุงูุตูุญุฉ!");
                    document.body.style.filter = "none";
                    document.title = fullExamData.config.title;
                }
            };
            document.addEventListener('visibilitychange', () => { if(document.hidden) handleViolation(); });
            window.addEventListener('focus', () => { document.body.style.filter = "none"; document.title = fullExamData.config.title; });
        }
    }
</script>
</body>
</html>
    